{"remainingRequest":"E:\\Front\\vue-manage-system-dev\\node_modules\\babel-loader\\lib\\index.js!E:\\Front\\vue-manage-system-dev\\src\\assets\\script\\util\\stompUtil.js","dependencies":[{"path":"E:\\Front\\vue-manage-system-dev\\src\\assets\\script\\util\\stompUtil.js","mtime":1581686428000},{"path":"E:\\Front\\vue-manage-system-dev\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Front\\vue-manage-system-dev\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import SockJS from \"sockjs-client\";\nimport Stomp from \"stompjs\";\nimport Vue from \"vue\";\nimport Cookies from \"js-cookie\";\nvar isServer = Vue.prototype.$isServer;\nexport default {\n  socket: null,\n  client: null,\n  connect: function connect() {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      if (isServer) {\n        reject(new Error(\"server\"));\n      } else {\n        // 是否初始化了\n        if (!_this.client) {\n          if (_this.socket) {\n            _this.socket.close();\n\n            _this.socket = null;\n          }\n\n          _this.socket = new SockJS(process.env.webSocketUrl);\n          _this.client = Stomp.over(_this.socket);\n          _this.client.debug = false;\n        } // 是否连接中\n\n\n        if (!_this.client.connected) {\n          _this.client.connect({\n            token: Cookies.get(\"token\") || \"\"\n          }, function () {\n            resolve(_this.client);\n          });\n        } else {\n          resolve(_this.client);\n        }\n      }\n    });\n  },\n  unsubscribeAll: function unsubscribeAll() {\n    // eslint-disable-next-line no-unused-vars\n    for (var sub in this.client.subscriptions) {\n      if (this.client.subscriptions.hasOwnProperty(sub)) {\n        this.client.unsubscribe(sub);\n      }\n    }\n  },\n  send: function send(eventName, params) {\n    var header = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    this.client.send(eventName, header, JSON.stringify(params));\n  },\n  disconnect: function disconnect() {\n    var _this2 = this;\n\n    var header = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return new Promise(function (resolve, reject) {\n      _this2.client.disconnect(function () {}, header);\n\n      _this2.socket.close();\n\n      _this2.client = null;\n      _this2.socket = null;\n      resolve();\n    });\n  }\n};",{"version":3,"sources":["E:/Front/vue-manage-system-dev/src/assets/script/util/stompUtil.js"],"names":["SockJS","Stomp","Vue","Cookies","isServer","prototype","$isServer","socket","client","connect","Promise","resolve","reject","Error","close","process","env","webSocketUrl","over","debug","connected","token","get","unsubscribeAll","sub","subscriptions","hasOwnProperty","unsubscribe","send","eventName","params","header","JSON","stringify","disconnect"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,eAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,GAAP,MAAgB,KAAhB;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA,IAAMC,QAAQ,GAAGF,GAAG,CAACG,SAAJ,CAAcC,SAA/B;AAEA,eAAe;AACbC,EAAAA,MAAM,EAAE,IADK;AAEbC,EAAAA,MAAM,EAAE,IAFK;AAGbC,EAAAA,OAHa,qBAGH;AAAA;;AACR,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAIR,QAAJ,EAAc;AACZQ,QAAAA,MAAM,CAAC,IAAIC,KAAJ,CAAU,QAAV,CAAD,CAAN;AACD,OAFD,MAEO;AACL;AACA,YAAI,CAAC,KAAI,CAACL,MAAV,EAAkB;AAChB,cAAI,KAAI,CAACD,MAAT,EAAiB;AACf,YAAA,KAAI,CAACA,MAAL,CAAYO,KAAZ;;AACA,YAAA,KAAI,CAACP,MAAL,GAAc,IAAd;AACD;;AACD,UAAA,KAAI,CAACA,MAAL,GAAc,IAAIP,MAAJ,CAAWe,OAAO,CAACC,GAAR,CAAYC,YAAvB,CAAd;AACA,UAAA,KAAI,CAACT,MAAL,GAAcP,KAAK,CAACiB,IAAN,CAAW,KAAI,CAACX,MAAhB,CAAd;AACA,UAAA,KAAI,CAACC,MAAL,CAAYW,KAAZ,GAAoB,KAApB;AACD,SAVI,CAWL;;;AACA,YAAI,CAAC,KAAI,CAACX,MAAL,CAAYY,SAAjB,EAA4B;AAC1B,UAAA,KAAI,CAACZ,MAAL,CAAYC,OAAZ,CAAoB;AAAEY,YAAAA,KAAK,EAAElB,OAAO,CAACmB,GAAR,CAAY,OAAZ,KAAwB;AAAjC,WAApB,EAA2D,YAAM;AAC/DX,YAAAA,OAAO,CAAC,KAAI,CAACH,MAAN,CAAP;AACD,WAFD;AAGD,SAJD,MAIO;AACLG,UAAAA,OAAO,CAAC,KAAI,CAACH,MAAN,CAAP;AACD;AACF;AACF,KAvBM,CAAP;AAwBD,GA5BY;AA6Bbe,EAAAA,cA7Ba,4BA6BI;AACf;AACA,SAAK,IAAMC,GAAX,IAAkB,KAAKhB,MAAL,CAAYiB,aAA9B,EAA6C;AAC3C,UAAI,KAAKjB,MAAL,CAAYiB,aAAZ,CAA0BC,cAA1B,CAAyCF,GAAzC,CAAJ,EAAmD;AACjD,aAAKhB,MAAL,CAAYmB,WAAZ,CAAwBH,GAAxB;AACD;AACF;AACF,GApCY;AAqCbI,EAAAA,IArCa,gBAqCRC,SArCQ,EAqCGC,MArCH,EAqCwB;AAAA,QAAbC,MAAa,uEAAJ,EAAI;AACnC,SAAKvB,MAAL,CAAYoB,IAAZ,CAAiBC,SAAjB,EAA4BE,MAA5B,EAAoCC,IAAI,CAACC,SAAL,CAAeH,MAAf,CAApC;AACD,GAvCY;AAwCbI,EAAAA,UAxCa,wBAwCW;AAAA;;AAAA,QAAbH,MAAa,uEAAJ,EAAI;AACtB,WAAO,IAAIrB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,MAAA,MAAI,CAACJ,MAAL,CAAY0B,UAAZ,CAAuB,YAAW,CAAE,CAApC,EAAsCH,MAAtC;;AACA,MAAA,MAAI,CAACxB,MAAL,CAAYO,KAAZ;;AACA,MAAA,MAAI,CAACN,MAAL,GAAc,IAAd;AACA,MAAA,MAAI,CAACD,MAAL,GAAc,IAAd;AACAI,MAAAA,OAAO;AACR,KANM,CAAP;AAOD;AAhDY,CAAf","sourcesContent":["import SockJS from \"sockjs-client\"\nimport Stomp from \"stompjs\"\nimport Vue from \"vue\"\nimport Cookies from \"js-cookie\"\n\nconst isServer = Vue.prototype.$isServer\n\nexport default {\n  socket: null,\n  client: null,\n  connect() {\n    return new Promise((resolve, reject) => {\n      if (isServer) {\n        reject(new Error(\"server\"))\n      } else {\n        // 是否初始化了\n        if (!this.client) {\n          if (this.socket) {\n            this.socket.close()\n            this.socket = null\n          }\n          this.socket = new SockJS(process.env.webSocketUrl)\n          this.client = Stomp.over(this.socket)\n          this.client.debug = false\n        }\n        // 是否连接中\n        if (!this.client.connected) {\n          this.client.connect({ token: Cookies.get(\"token\") || \"\" }, () => {\n            resolve(this.client)\n          })\n        } else {\n          resolve(this.client)\n        }\n      }\n    })\n  },\n  unsubscribeAll() {\n    // eslint-disable-next-line no-unused-vars\n    for (const sub in this.client.subscriptions) {\n      if (this.client.subscriptions.hasOwnProperty(sub)) {\n        this.client.unsubscribe(sub)\n      }\n    }\n  },\n  send(eventName, params, header = {}) {\n    this.client.send(eventName, header, JSON.stringify(params))\n  },\n  disconnect(header = {}) {\n    return new Promise((resolve, reject) => {\n      this.client.disconnect(function() {}, header)\n      this.socket.close()\n      this.client = null\n      this.socket = null\n      resolve()\n    })\n  }\n}\n"]}]}